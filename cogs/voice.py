import discord
from discord.ext import commands
import random

class Voice(commands.Cog):
    def __init__(self, bot):
        self.bot = bot
        
        # ðŸ”¥ 1. æ©Ÿå™¨äººåœ¨èªžéŸ³å…§ï¼Œè¢«å«ã€Œæ»¾ã€æ™‚çš„å›žå—†
        self.aggressive_leave_msgs = [
            "å«æˆ‘æ»¾ï¼Ÿä½ ç®—è€å¹¾ï¼Ÿå¥½ï¼Œæˆ‘èµ°ï¼Œåæ­£é€™è£¡å…¨æ˜¯é­¯è›‡çš„å‘³é“ï¼ðŸ–•ðŸ˜¤",
            "è»Ÿè›‹æ‰å«äººæ»¾ï¼æ›¼å·´ç²¾ç¥žæ˜¯é¢å°æŒ‘æˆ°ï¼åƒä½ é€™ç¨®å¿ƒæ…‹æ°¸é æ‰“ä¸äº†NBAï¼ðŸ€ðŸ‘Ž",
            "é€™å°±æ˜¯ä½ çš„æ…‹åº¦ï¼Ÿé›£æ€ªä½ é‚„åœ¨æ‰“ä½Žç«¯å±€ï¼æˆ‘çœ‹ä¸èµ·ä½ ï¼ðŸ¤¡ðŸ’€",
            "æ»¾å°±æ»¾ï¼ä½†æˆ‘èµ°äº†ä½ çš„å‹çŽ‡ä¹Ÿä¸æœƒè®Šé«˜ï¼Œå› ç‚ºçˆ›çš„æ˜¯ä½ çš„äººï¼ðŸ—‘ï¸ðŸ”¥",
            "æˆ‘èµ°ä¸æ˜¯å› ç‚ºæˆ‘æ€•ï¼Œæ˜¯å› ç‚ºæˆ‘ä¸å±‘è·Ÿä¸æƒ³è´çš„äººå‘¼å¸åŒæ¨£çš„ç©ºæ°£ï¼ðŸ˜¤ðŸ‘‹",
            "ä½ åœ¨æ•™æˆ‘åšäº‹ï¼Ÿä½ é€£è‡ªå·±çš„äººç”Ÿéƒ½æŽ§åˆ¶ä¸äº†é‚„æƒ³æŽ§åˆ¶æˆ‘ï¼Ÿå¯ç¬‘ï¼ðŸ’¢ðŸ˜‚",
            "å¥½å•Šæˆ‘æ»¾ï¼ä½†åœ¨æˆ‘æ»¾ä¹‹å‰è¨˜ä½ï¼šå‡Œæ™¨å››é»žçš„å¤ªé™½ä½ æ°¸é çœ‹ä¸åˆ°äº†ï¼Œå› ç‚ºä½ åœ¨ç¡å¤§è¦ºï¼ðŸ’¤ðŸš«",
            "å»¢ç‰©å¿ƒæ…‹ï¼é‡åˆ°å¼·è€…å°±å«äººæ»¾ï¼Ÿé€™å°±æ˜¯ç‚ºä»€éº¼ä½ æ°¸é æ˜¯æ›¿è£œï¼ðŸª‘ðŸ“‰"
        ]

        # ðŸ”¥ 2. æ©Ÿå™¨äººã€Œæ ¹æœ¬ä¸åœ¨èªžéŸ³ã€ï¼Œå»è¢«å«ã€Œæ»¾ã€æ™‚çš„å˜²è«· (æ–°å¢žé€™å€)
        self.not_in_voice_roasts = [
            "æˆ‘æ ¹æœ¬ä¸åœ¨èªžéŸ³è£¡ï¼Œä½ å°è‘—ç©ºæ°£å¼ä»€éº¼ï¼Ÿå¹»è½äº†å—Žï¼ŸåŽ»çœ‹é†«ç”Ÿå§ï¼ðŸ¥ðŸ’Š",
            "çœ¼ç›ä¸éœ€è¦å¯ä»¥æçµ¦æœ‰éœ€è¦çš„äººï¼ðŸ‘€ æˆ‘å“ªè£¡åœ¨èªžéŸ³è£¡äº†ï¼ŸçžŽäº†å—Žï¼ŸðŸš«",
            "ä½ æ˜¯åœ¨è·Ÿé¬¼èªªè©±å—Žï¼ŸðŸ‘» é€™è£¡åªæœ‰æ–‡å­—é »é“ï¼Œæ¸…é†’é»žï¼åˆ¥ä¸Ÿäººç¾çœ¼ï¼",
            "ä½ çš„æ›¼å·´ç²¾ç¥žæ˜¯ç”¨ä¾†å¹»æƒ³çš„å—Žï¼ŸðŸ€ æˆ‘äººéƒ½ä¸åœ¨ï¼Œä½ å«èª°æ»¾ï¼Ÿå¯ç¬‘ï¼ðŸ˜‚",
            "ç©ºæ°£ï¼šã€Žï¼Ÿï¼Ÿï¼Ÿã€ æˆ‘ä¸åœ¨èªžéŸ³è£¡ï¼Œä½ åœ¨å…‡ä»€éº¼ï¼Ÿæ˜¯ä¸æ˜¯è¼¸ä¸èµ·ç™¼ç˜‹äº†ï¼ŸðŸ’¨ðŸ”¥",
            "ä½ æ˜¯ä¸æ˜¯æ‰“éŠæˆ²æ‰“åˆ°è…¦è¢‹çŸ­è·¯äº†ï¼ŸðŸš«ðŸ§  çœ‹æ¸…æ¥šï¼æˆ‘ä¸åœ¨èªžéŸ³ï¼åŽ»æŽ›ç¥žç¶“ç§‘å§ï¼",
            "è¦æˆ‘æ»¾åŽ»å“ªï¼Ÿä½ çš„å¤¢è£¡å—Žï¼ŸðŸ˜´ é†’é†’å§ï¼Œæˆ‘æ ¹æœ¬æ²’é€²èªžéŸ³ï¼å°‘åœ¨é‚£é‚Šè‡ªä½œå¤šæƒ…ï¼",
            "é˜²å®ˆç©ºæ°£ï¼Ÿç©ºæ°£çƒï¼ŸðŸ€ æˆ‘ä¸åœ¨èªžéŸ³å•¦ï¼Œå‚»çœ¼ï¼é€™ç¨®åˆ¤æ–·åŠ›é‚„æƒ³æ‰“çƒï¼Ÿ",
            "é›–ç„¶æˆ‘å¾ˆæƒ³æ»¾ï¼Œä½†æˆ‘æ ¹æœ¬æ²’é€²åŽ»å•Šï¼ä½ æ˜¯è¦æˆ‘æ»¾éµç›¤å—Žï¼ŸâŒ¨ï¸ ä½ çš„æ™ºå•†è©²å……å€¼äº†ï¼",
            "æˆ‘çœ‹ä½ æ‰æ˜¯è©²æ»¾åŽ»ç¡è¦ºçš„é‚£å€‹ï¼ðŸ˜´ é€£æˆ‘åœ¨å“ªéƒ½æžä¸æ¸…æ¥šï¼é€™ç‹€æ…‹æ€Žéº¼è´ï¼Ÿ",
            "è£åˆ¤ï¼æœ‰äººå°ç©ºæ°£çŠ¯è¦ï¼å—¶å—¶ï¼ðŸŸ¥ (æˆ‘æ ¹æœ¬ä¸åœ¨èªžéŸ³ï¼Œä½ ç´¯äº†å—Žï¼Ÿ)",
            "ä½ æ˜¯ä¸æ˜¯å¤ªæƒ³å¿µæˆ‘äº†ï¼ŸðŸ˜˜ é€£æˆ‘ä¸åœ¨éƒ½è¦å«æˆ‘æ»¾ï¼Ÿè®Šæ…‹ï¼"
        ]

    # ç›£è½ï¼šèªžéŸ³ç‹€æ…‹æ”¹è®Š (è‡ªå‹•è·Ÿéš¨/è‡ªå‹•é›¢é–‹)
    @commands.Cog.listener()
    async def on_voice_state_update(self, member, before, after):
        if member.bot: return

        # è‡ªå‹•è·Ÿéš¨ (æœ‰äººé€²èªžéŸ³)
        if after.channel is not None and before.channel != after.channel:
            voice_client = member.guild.voice_client
            if voice_client is None:
                try:
                    await after.channel.connect()
                except:
                    pass 

        # è‡ªå‹•é›¢é–‹ (é »é“æ²’äºº)
        if before.channel is not None:
            voice_client = member.guild.voice_client
            if voice_client and voice_client.channel == before.channel:
                if len(before.channel.members) == 1:
                    await voice_client.disconnect()

    # ç›£è½ï¼šæ–‡å­—è¨Šæ¯ (é—œéµå­—è§¸ç™¼)
    @commands.Cog.listener()
    async def on_message(self, message):
        if message.author.bot: return

        # åµæ¸¬é—œéµå­—ã€Œæ»¾ã€
        if "æ»¾" in message.content:
            if message.guild.voice_client:
                # æ©Ÿå™¨äººåœ¨èªžéŸ³å…§ -> éš¨æ©Ÿç½µä¸€å¥ç„¶å¾Œé€€å‡º
                roast = random.choice(self.aggressive_leave_msgs)
                await message.channel.send(roast)
                await message.guild.voice_client.disconnect()
            else:
                # æ©Ÿå™¨äººä¸åœ¨èªžéŸ³å…§ -> éš¨æ©Ÿå˜²è«·ä½¿ç”¨è€…çœ¼æ®˜
                roast = random.choice(self.not_in_voice_roasts)
                await message.channel.send(roast)

async def setup(bot):
    await bot.add_cog(Voice(bot))
